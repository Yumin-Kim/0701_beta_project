!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).MaplibreGrid={})}(this,(function(t){"use strict";function i(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e=6371008.8,o={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*e,kilometers:6371.0088,kilometres:6371.0088,meters:e,metres:e,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:e/1852,radians:1,yards:6967335.223679999};function r(t){return 180*(t%(2*Math.PI))/Math.PI}function n(t){return t%360*Math.PI/180}function a(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function s(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function u(t,i,e){void 0===e&&(e={});var r=s(t),a=s(i),u=n(a[1]-r[1]),h=n(a[0]-r[0]),c=n(r[1]),d=n(a[1]),f=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(c)*Math.cos(d);return function(t,i){void 0===i&&(i="kilometers");var e=o[i];if(!e)throw new Error(i+" units is invalid");return t*e}(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),e.units)}function h(t,i,e,u){void 0===u&&(u={});var h=s(t),c=n(h[0]),d=n(h[1]),f=n(e),l=function(t,i){void 0===i&&(i="kilometers");var e=o[i];if(!e)throw new Error(i+" units is invalid");return t/e}(i,u.units),m=Math.asin(Math.sin(d)*Math.cos(l)+Math.cos(d)*Math.sin(l)*Math.cos(f));return function(t,i,e){if(void 0===e&&(e={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!a(t[0])||!a(t[1]))throw new Error("coordinates must contain numbers");return function(t,i,e){void 0===e&&(e={});var o={type:"Feature"};return(0===e.id||e.id)&&(o.id=e.id),e.bbox&&(o.bbox=e.bbox),o.properties=i||{},o.geometry=t,o}({type:"Point",coordinates:t},i,e)}([r(c+Math.atan2(Math.sin(f)*Math.sin(l)*Math.cos(d),Math.cos(l)-Math.sin(d)*Math.sin(m))),r(m)],u.properties)}var c="grid.click",d="grid.mousemove";function f(){return Math.floor(1e13*Math.random()).toString(36)}var l=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.id="grid-".concat(f()),this.config=i,this.startPoint=null,this.updateBound=this.update.bind(this),this.onMapClickBound=this.onMapClick.bind(this),this.onMapMouseMoveBound=this.onMapMouseMove.bind(this)}var e,o,r;return e=t,o=[{key:"onAdd",value:function(t){return this.map=t,this.map.on("load",this.updateBound),this.map.on("move",this.updateBound),this.map.on("click",this.onMapClickBound),this.map.on("mousemove",this.onMapMouseMoveBound),this.map.loaded()&&this.update(),document.createElement("div")}},{key:"onRemove",value:function(){this.map&&(this.map.getSource(this.id)&&(this.map.removeLayer(this.id),this.map.removeSource(this.id)),this.map.off("load",this.updateBound),this.map.off("move",this.updateBound),this.map.off("click",this.onMapClickBound),this.map.off("mousemove",this.onMapMouseMoveBound),this.map=void 0)}},{key:"update",value:function(){if(this.map){var t=[];this.active&&(t=function(t,i,e,o){var r,n=Math.ceil(2*u([0,0],[180,0],{units:o})),a=Math.floor(n/i),s=function(t,i,e){var o=u(t,i,e);return Math.abs(i[0]-t[0])>=180?n-o:o},c=[],d=t[0],f=t[1],l=t[2],m=t[3],p=(d<0?-1:1)*s([0,0],[d,0],{units:o}),M=(f<0?-1:1)*s([0,0],[0,f],{units:o}),v=Math.ceil(p/i)*i,y=Math.ceil(M/e)*e,g=[h([0,0],v,90,{units:o}).geometry.coordinates[0],h([0,0],y,0,{units:o}).geometry.coordinates[1]],b=s([d,0],[l,0],{units:o}),w=s([0,f],[0,m],{units:o}),k=Math.min(Math.ceil(b/i),a),E=Math.ceil(w/e);r=g;for(var A=0;A<k;A++){var P={type:"Feature",geometry:{type:"LineString",coordinates:[[r[0],f],[r[0],m]]},properties:{}};c.push(P),r=[h([r[0],0],i,90,{units:o}).geometry.coordinates[0],r[1]]}r=g;for(var B=0;B<E;B++){var x={type:"Feature",geometry:{type:"LineString",coordinates:[[d,r[1]],[l,r[1]]]},properties:{}};c.push(x),r=[r[0],h([0,r[1]],e,0,{units:o}).geometry.coordinates[1]]}return c}(this.bbox,this.config.gridWidth,this.config.gridHeight,this.config.units));var i,e=this.map.getSource(this.id);e?e.setData({type:"FeatureCollection",features:t}):(this.map.addSource(this.id,{type:"geojson",data:{type:"FeatureCollection",features:t}}),this.map.addLayer({id:this.id,source:this.id,type:"line",paint:null!==(i=this.config.paint)&&void 0!==i?i:{}}))}}},{key:"active",get:function(){var t,i;if(!this.map)return!1;var e=null!==(t=this.config.minZoom)&&void 0!==t?t:0,o=null!==(i=this.config.maxZoom)&&void 0!==i?i:22,r=this.map.getZoom();return e<=r&&r<o}},{key:"bbox",get:function(){if(!this.map)throw new Error("Invalid state");var t=this.map.getBounds();return t.getEast()-t.getWest()>=360&&t.setNorthEast([t.getWest()+360,t.getNorth()]),t.toArray().flat()}},{key:"onMapClick",value:function(t){if(this.map&&this.active){var i=t.lngLat.toArray(),e=function(t,i,e,o){var r=Math.ceil(2*u([0,0],[180,0],{units:o})),n=function(t,i,e){var o=u(t,i,e);return Math.abs(i[0]-t[0])>=180?r-o:o},a=(t[0]<0?-1:1)*n([0,0],[t[0],0],{units:o}),s=(t[1]<0?-1:1)*n([0,0],[0,t[1]],{units:o}),c=Math.floor(a/i)*i,d=Math.floor(s/e)*e,f=Math.ceil(a/i)*i,l=Math.ceil(s/e)*e;return[h([0,0],c,90,{units:o}).geometry.coordinates[0],h([0,0],d,0,{units:o}).geometry.coordinates[1],h([0,0],f,90,{units:o}).geometry.coordinates[0],h([0,0],l,0,{units:o}).geometry.coordinates[1]]}(i,this.config.gridWidth,this.config.gridWidth,this.config.units);this.startPoint=this.startPoint?null:i;var o={bbox:e};this.map.fire(c,o)}}},{key:"onMapMouseMove",value:function(t){if(this.map&&this.active&&this.startPoint){var i=t.lngLat.toArray(),e={bboxes:function(t,i,e,o,r){var n=Math.ceil(2*u([0,0],[180,0],{units:r})),a=function(t,i,e){var o=u(t,i,e);return Math.abs(i[0]-t[0])>=180?n-o:o},s=(t[0]<0?-1:1)*a([0,0],[t[0],0],{units:r}),c=(t[1]<0?-1:1)*a([0,0],[0,t[1]],{units:r}),d=Math.floor(s/e)*e,f=Math.floor(c/o)*o,l=(i[0]<0?-1:1)*a([0,0],[i[0],0],{units:r}),m=(i[1]<0?-1:1)*a([0,0],[0,i[1]],{units:r}),p=Math.floor(l/e)*e,M=Math.floor(m/o)*o,v=p,y=d;d<p&&(v=d,y=p);var g=M,b=f;f<M&&(g=f,b=M);for(var w=[],k=v;k<=y;k+=e)for(var E=g;E<=b;E+=o)w.push([h([0,0],k,90,{units:r}).geometry.coordinates[0],h([0,0],E,0,{units:r}).geometry.coordinates[1],h([0,0],k+e,90,{units:r}).geometry.coordinates[0],h([0,0],E+o,0,{units:r}).geometry.coordinates[1]]);return w}(this.startPoint,i,this.config.gridWidth,this.config.gridWidth,this.config.units)};this.map.fire(d,e)}}}],o&&i(e.prototype,o),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.GRID_CLICK_EVENT=c,t.GRID_MOUSE_MOVE_EVENT=d,t.Grid=l,t.randomString=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=maplibre-grid.min.js.map
